var Module=typeof Module!=="undefined"?Module:{};(function(){var Module={print:function(text){text=Array.prototype.slice.call(arguments).join(" ");console.log(text)},printErr:function(text){text=Array.prototype.slice.call(arguments).join(" ");console.error(text)},canvas:{},noInitialRun:true};var moduleOverrides={};var key;for(key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var arguments_=[];var thisProgram="./this.program";var quit_=function(status,toThrow){throw toThrow};var ENVIRONMENT_IS_WEB=false;var ENVIRONMENT_IS_WORKER=false;var ENVIRONMENT_IS_NODE=false;var ENVIRONMENT_IS_SHELL=false;ENVIRONMENT_IS_WEB=typeof window==="object";ENVIRONMENT_IS_WORKER=typeof importScripts==="function";ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var read_,readAsync,readBinary,setWindowTitle;var nodeFS;var nodePath;if(ENVIRONMENT_IS_NODE){if(ENVIRONMENT_IS_WORKER){scriptDirectory=require("path").dirname(scriptDirectory)+"/"}else{scriptDirectory=__dirname+"/"}read_=function shell_read(filename,binary){if(!nodeFS)nodeFS=require("fs");if(!nodePath)nodePath=require("path");filename=nodePath["normalize"](filename);return nodeFS["readFileSync"](filename,binary?null:"utf8")};readBinary=function readBinary(filename){var ret=read_(filename,true);if(!ret.buffer){ret=new Uint8Array(ret)}assert(ret.buffer);return ret};if(process["argv"].length>1){thisProgram=process["argv"][1].replace(/\\/g,"/")}arguments_=process["argv"].slice(2);if(typeof module!=="undefined"){module["exports"]=Module}process["on"]("uncaughtException",function(ex){if(!(ex instanceof ExitStatus)){throw ex}});process["on"]("unhandledRejection",abort);quit_=function(status){process["exit"](status)};Module["inspect"]=function(){return"[Emscripten Module object]"}}else if(ENVIRONMENT_IS_SHELL){if(typeof read!="undefined"){read_=function shell_read(f){return read(f)}}readBinary=function readBinary(f){var data;if(typeof readbuffer==="function"){return new Uint8Array(readbuffer(f))}data=read(f,"binary");assert(typeof data==="object");return data};if(typeof scriptArgs!="undefined"){arguments_=scriptArgs}else if(typeof arguments!="undefined"){arguments_=arguments}if(typeof quit==="function"){quit_=function(status){quit(status)}}if(typeof print!=="undefined"){if(typeof console==="undefined")console={};console.log=print;console.warn=console.error=typeof printErr!=="undefined"?printErr:print}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!=="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.indexOf("blob:")!==0){scriptDirectory=scriptDirectory.substr(0,scriptDirectory.lastIndexOf("/")+1)}else{scriptDirectory=""}{read_=function(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(ENVIRONMENT_IS_WORKER){readBinary=function(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=function(url,onload,onerror){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function(){if(xhr.status==200||xhr.status==0&&xhr.response){onload(xhr.response);return}onerror()};xhr.onerror=onerror;xhr.send(null)}}setWindowTitle=function(title){document.title=title}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.warn.bind(console);for(key in moduleOverrides){if(moduleOverrides.hasOwnProperty(key)){Module[key]=moduleOverrides[key]}}moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];if(Module["quit"])quit_=Module["quit"];var STACK_ALIGN=16;function warnOnce(text){if(!warnOnce.shown)warnOnce.shown={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;err(text)}}function convertJsFunctionToWasm(func,sig){if(typeof WebAssembly.Function==="function"){var typeNames={"i":"i32","j":"i64","f":"f32","d":"f64"};var type={parameters:[],results:sig[0]=="v"?[]:[typeNames[sig[0]]]};for(var i=1;i<sig.length;++i){type.parameters.push(typeNames[sig[i]])}return new WebAssembly.Function(type,func)}var typeSection=[1,0,1,96];var sigRet=sig.slice(0,1);var sigParam=sig.slice(1);var typeCodes={"i":127,"j":126,"f":125,"d":124};typeSection.push(sigParam.length);for(var i=0;i<sigParam.length;++i){typeSection.push(typeCodes[sigParam[i]])}if(sigRet=="v"){typeSection.push(0)}else{typeSection=typeSection.concat([1,typeCodes[sigRet]])}typeSection[1]=typeSection.length-2;var bytes=new Uint8Array([0,97,115,109,1,0,0,0].concat(typeSection,[2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0]));var module=new WebAssembly.Module(bytes);var instance=new WebAssembly.Instance(module,{"e":{"f":func}});var wrappedFunc=instance.exports["f"];return wrappedFunc}var freeTableIndexes=[];var functionsInTableMap;function getEmptyTableSlot(){if(freeTableIndexes.length){return freeTableIndexes.pop()}try{wasmTable.grow(1)}catch(err){if(!(err instanceof RangeError)){throw err}throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return wasmTable.length-1}function addFunctionWasm(func,sig){if(!functionsInTableMap){functionsInTableMap=new WeakMap;for(var i=0;i<wasmTable.length;i++){var item=wasmTable.get(i);if(item){functionsInTableMap.set(item,i)}}}if(functionsInTableMap.has(func)){return functionsInTableMap.get(func)}var ret=getEmptyTableSlot();try{wasmTable.set(ret,func)}catch(err){if(!(err instanceof TypeError)){throw err}var wrapped=convertJsFunctionToWasm(func,sig);wasmTable.set(ret,wrapped)}functionsInTableMap.set(func,ret);return ret}var tempRet0=0;var setTempRet0=function(value){tempRet0=value};var wasmBinary;if(Module["wasmBinary"])wasmBinary=Module["wasmBinary"];var noExitRuntime;if(Module["noExitRuntime"])noExitRuntime=Module["noExitRuntime"];if(typeof WebAssembly!=="object"){abort("no native wasm support detected")}function setValue(ptr,value,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":HEAP8[ptr>>0]=value;break;case"i8":HEAP8[ptr>>0]=value;break;case"i16":HEAP16[ptr>>1]=value;break;case"i32":HEAP32[ptr>>2]=value;break;case"i64":tempI64=[value>>>0,(tempDouble=value,+Math.abs(tempDouble)>=1?tempDouble>0?(Math.min(+Math.floor(tempDouble/4294967296),4294967295)|0)>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[ptr>>2]=tempI64[0],HEAP32[ptr+4>>2]=tempI64[1];break;case"float":HEAPF32[ptr>>2]=value;break;case"double":HEAPF64[ptr>>3]=value;break;default:abort("invalid type for setValue: "+type)}}function getValue(ptr,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":return HEAP8[ptr>>0];case"i8":return HEAP8[ptr>>0];case"i16":return HEAP16[ptr>>1];case"i32":return HEAP32[ptr>>2];case"i64":return HEAP32[ptr>>2];case"float":return HEAPF32[ptr>>2];case"double":return HEAPF64[ptr>>3];default:abort("invalid type for getValue: "+type)}return null}var wasmMemory;var ABORT=false;var EXITSTATUS;function assert(condition,text){if(!condition){abort("Assertion failed: "+text)}}function getCFunc(ident){var func=Module["_"+ident];assert(func,"Cannot call unknown function "+ident+", make sure it is exported");return func}function ccall(ident,returnType,argTypes,args,opts){var toC={"string":function(str){var ret=0;if(str!==null&&str!==undefined&&str!==0){var len=(str.length<<2)+1;ret=stackAlloc(len);stringToUTF8(str,ret,len)}return ret},"array":function(arr){var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string")return UTF8ToString(ret);if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func.apply(null,cArgs);ret=convertReturnValue(ret);if(stack!==0)stackRestore(stack);return ret}function cwrap(ident,returnType,argTypes,opts){argTypes=argTypes||[];var numericArgs=argTypes.every(function(type){return type==="number"});var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return function(){return ccall(ident,returnType,argTypes,arguments,opts)}}var ALLOC_STACK=1;var UTF8Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf8"):undefined;function UTF8ArrayToString(heap,idx,maxBytesToRead){var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heap[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heap.subarray&&UTF8Decoder){return UTF8Decoder.decode(heap.subarray(idx,endPtr))}else{var str="";while(idx<endPtr){var u0=heap[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heap[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heap[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heap[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}}return str}function UTF8ToString(ptr,maxBytesToRead){return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""}function stringToUTF8Array(str,heap,outIdx,maxBytesToWrite){if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++]=192|u>>6;heap[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++]=224|u>>12;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++]=240|u>>18;heap[outIdx++]=128|u>>12&63;heap[outIdx++]=128|u>>6&63;heap[outIdx++]=128|u&63}}heap[outIdx]=0;return outIdx-startIdx}function stringToUTF8(str,outPtr,maxBytesToWrite){return stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite)}function lengthBytesUTF8(str){var len=0;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127)++len;else if(u<=2047)len+=2;else if(u<=65535)len+=3;else len+=4}return len}var UTF16Decoder=typeof TextDecoder!=="undefined"?new TextDecoder("utf-16le"):undefined;function writeArrayToMemory(array,buffer){HEAP8.set(array,buffer)}function writeAsciiToMemory(str,buffer,dontAddNull){for(var i=0;i<str.length;++i){HEAP8[buffer++>>0]=str.charCodeAt(i)}if(!dontAddNull)HEAP8[buffer>>0]=0}function alignUp(x,multiple){if(x%multiple>0){x+=multiple-x%multiple}return x}var buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function updateGlobalBufferAndViews(buf){buffer=buf;Module["HEAP8"]=HEAP8=new Int8Array(buf);Module["HEAP16"]=HEAP16=new Int16Array(buf);Module["HEAP32"]=HEAP32=new Int32Array(buf);Module["HEAPU8"]=HEAPU8=new Uint8Array(buf);Module["HEAPU16"]=HEAPU16=new Uint16Array(buf);Module["HEAPU32"]=HEAPU32=new Uint32Array(buf);Module["HEAPF32"]=HEAPF32=new Float32Array(buf);Module["HEAPF64"]=HEAPF64=new Float64Array(buf)}var INITIAL_MEMORY=Module["INITIAL_MEMORY"]||16777216;var wasmTable;var __ATPRERUN__=[];var __ATINIT__=[];var __ATMAIN__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;var runtimeExited=false;__ATINIT__.push({func:function(){___wasm_call_ctors()}});function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){runtimeExited=true}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function addRunDependency(id){runDependencies++;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}}function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["preloadedImages"]={};Module["preloadedAudios"]={};function abort(what){if(Module["onAbort"]){Module["onAbort"](what)}what+="";err(what);ABORT=true;EXITSTATUS=1;what="abort("+what+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(what);throw e}function hasPrefix(str,prefix){return String.prototype.startsWith?str.startsWith(prefix):str.indexOf(prefix)===0}var dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(filename){return hasPrefix(filename,dataURIPrefix)}var fileURIPrefix="file://";function isFileURI(filename){return hasPrefix(filename,fileURIPrefix)}var wasmBinaryFile="libde265.wasm";if(!isDataURI(wasmBinaryFile)){wasmBinaryFile=locateFile(wasmBinaryFile)}function getBinary(file){try{if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}else{throw"both async and sync fetching of the wasm failed"}}catch(err){abort(err)}}function getBinaryPromise(){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)){if(typeof fetch==="function"&&!isFileURI(wasmBinaryFile)){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){if(!response["ok"]){throw"failed to load wasm binary file at '"+wasmBinaryFile+"'"}return response["arrayBuffer"]()}).catch(function(){return getBinary(wasmBinaryFile)})}else{if(readAsync){return new Promise(function(resolve,reject){readAsync(wasmBinaryFile,function(response){resolve(new Uint8Array(response))},reject)})}}}return Promise.resolve().then(function(){return getBinary(wasmBinaryFile)})}function createWasm(){var info={"env":asmLibraryArg,"wasi_snapshot_preview1":asmLibraryArg};function receiveInstance(instance,module){var exports=instance.exports;Module["asm"]=exports;wasmMemory=Module["asm"]["memory"];updateGlobalBufferAndViews(wasmMemory.buffer);wasmTable=Module["asm"]["__indirect_function_table"];removeRunDependency("wasm-instantiate")}addRunDependency("wasm-instantiate");function receiveInstantiatedSource(output){receiveInstance(output["instance"])}function instantiateArrayBuffer(receiver){return getBinaryPromise().then(function(binary){return WebAssembly.instantiate(binary,info)}).then(receiver,function(reason){err("failed to asynchronously prepare wasm: "+reason);abort(reason)})}function instantiateAsync(){if(!wasmBinary&&typeof WebAssembly.instantiateStreaming==="function"&&!isDataURI(wasmBinaryFile)&&!isFileURI(wasmBinaryFile)&&typeof fetch==="function"){return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(response){var result=WebAssembly.instantiateStreaming(response,info);return result.then(receiveInstantiatedSource,function(reason){err("wasm streaming compile failed: "+reason);err("falling back to ArrayBuffer instantiation");return instantiateArrayBuffer(receiveInstantiatedSource)})})}else{return instantiateArrayBuffer(receiveInstantiatedSource)}}if(Module["instantiateWasm"]){try{var exports=Module["instantiateWasm"](info,receiveInstance);return exports}catch(e){err("Module.instantiateWasm callback failed with error: "+e);return false}}instantiateAsync();return{}}var tempDouble;var tempI64;function callRuntimeCallbacks(callbacks){while(callbacks.length>0){var callback=callbacks.shift();if(typeof callback=="function"){callback(Module);continue}var func=callback.func;if(typeof func==="number"){if(callback.arg===undefined){wasmTable.get(func)()}else{wasmTable.get(func)(callback.arg)}}else{func(callback.arg===undefined?null:callback.arg)}}}function demangle(func){return func}function demangleAll(text){var regex=/\b_Z[\w\d_]+/g;return text.replace(regex,function(x){var y=demangle(x);return x===y?x:y+" ["+x+"]"})}function jsStackTrace(){var error=new Error;if(!error.stack){try{throw new Error}catch(e){error=e}if(!error.stack){return"(no stack trace available)"}}return error.stack.toString()}function ___assert_fail(condition,filename,line,func){abort("Assertion failed: "+UTF8ToString(condition)+", at: "+[filename?UTF8ToString(filename):"unknown filename",line,func?UTF8ToString(func):"unknown function"])}var ExceptionInfoAttrs={DESTRUCTOR_OFFSET:0,REFCOUNT_OFFSET:4,TYPE_OFFSET:8,CAUGHT_OFFSET:12,RETHROWN_OFFSET:13,SIZE:16};function ___cxa_allocate_exception(size){return _malloc(size+ExceptionInfoAttrs.SIZE)+ExceptionInfoAttrs.SIZE}function _atexit(func,arg){}function ___cxa_atexit(a0,a1){return _atexit(a0,a1)}function ExceptionInfo(excPtr){this.excPtr=excPtr;this.ptr=excPtr-ExceptionInfoAttrs.SIZE;this.set_type=function(type){HEAP32[this.ptr+ExceptionInfoAttrs.TYPE_OFFSET>>2]=type};this.get_type=function(){return HEAP32[this.ptr+ExceptionInfoAttrs.TYPE_OFFSET>>2]};this.set_destructor=function(destructor){HEAP32[this.ptr+ExceptionInfoAttrs.DESTRUCTOR_OFFSET>>2]=destructor};this.get_destructor=function(){return HEAP32[this.ptr+ExceptionInfoAttrs.DESTRUCTOR_OFFSET>>2]};this.set_refcount=function(refcount){HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2]=refcount};this.set_caught=function(caught){caught=caught?1:0;HEAP8[this.ptr+ExceptionInfoAttrs.CAUGHT_OFFSET>>0]=caught};this.get_caught=function(){return HEAP8[this.ptr+ExceptionInfoAttrs.CAUGHT_OFFSET>>0]!=0};this.set_rethrown=function(rethrown){rethrown=rethrown?1:0;HEAP8[this.ptr+ExceptionInfoAttrs.RETHROWN_OFFSET>>0]=rethrown};this.get_rethrown=function(){return HEAP8[this.ptr+ExceptionInfoAttrs.RETHROWN_OFFSET>>0]!=0};this.init=function(type,destructor){this.set_type(type);this.set_destructor(destructor);this.set_refcount(0);this.set_caught(false);this.set_rethrown(false)};this.add_ref=function(){var value=HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2];HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2]=value+1};this.release_ref=function(){var prev=HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2];HEAP32[this.ptr+ExceptionInfoAttrs.REFCOUNT_OFFSET>>2]=prev-1;return prev===1}}var exceptionLast=0;var uncaughtExceptionCount=0;function ___cxa_throw(ptr,type,destructor){var info=new ExceptionInfo(ptr);info.init(type,destructor);exceptionLast=ptr;uncaughtExceptionCount++;throw ptr}function _abort(){abort()}function _emscripten_memcpy_big(dest,src,num){HEAPU8.copyWithin(dest,src,src+num)}function _emscripten_get_heap_size(){return HEAPU8.length}function emscripten_realloc_buffer(size){try{wasmMemory.grow(size-buffer.byteLength+65535>>>16);updateGlobalBufferAndViews(wasmMemory.buffer);return 1}catch(e){}}function _emscripten_resize_heap(requestedSize){requestedSize=requestedSize>>>0;var oldSize=_emscripten_get_heap_size();var maxHeapSize=2147483648;if(requestedSize>maxHeapSize){return false}var minHeapSize=16777216;for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignUp(Math.max(minHeapSize,requestedSize,overGrownHeapSize),65536));var replacement=emscripten_realloc_buffer(newSize);if(replacement){return true}}return false}var SYSCALLS={mappings:{},buffers:[null,[],[]],printChar:function(stream,curr){var buffer=SYSCALLS.buffers[stream];if(curr===0||curr===10){(stream===1?out:err)(UTF8ArrayToString(buffer,0));buffer.length=0}else{buffer.push(curr)}},varargs:undefined,get:function(){SYSCALLS.varargs+=4;var ret=HEAP32[SYSCALLS.varargs-4>>2];return ret},getStr:function(ptr){var ret=UTF8ToString(ptr);return ret},get64:function(low,high){return low}};function _fd_close(fd){return 0}function _fd_seek(fd,offset_low,offset_high,whence,newOffset){}function _fd_write(fd,iov,iovcnt,pnum){var num=0;for(var i=0;i<iovcnt;i++){var ptr=HEAP32[iov+i*8>>2];var len=HEAP32[iov+(i*8+4)>>2];for(var j=0;j<len;j++){SYSCALLS.printChar(fd,HEAPU8[ptr+j])}num+=len}HEAP32[pnum>>2]=num;return 0}function _pthread_create(){return 6}function _pthread_join(){return 28}function _setTempRet0($i){setTempRet0($i|0)}var ASSERTIONS=false;var asmLibraryArg={"__assert_fail":___assert_fail,"__cxa_allocate_exception":___cxa_allocate_exception,"__cxa_atexit":___cxa_atexit,"__cxa_throw":___cxa_throw,"abort":_abort,"emscripten_memcpy_big":_emscripten_memcpy_big,"emscripten_resize_heap":_emscripten_resize_heap,"fd_close":_fd_close,"fd_seek":_fd_seek,"fd_write":_fd_write,"pthread_create":_pthread_create,"pthread_join":_pthread_join,"setTempRet0":_setTempRet0};var asm=createWasm();var ___wasm_call_ctors=Module["___wasm_call_ctors"]=function(){return(___wasm_call_ctors=Module["___wasm_call_ctors"]=Module["asm"]["__wasm_call_ctors"]).apply(null,arguments)};var _free=Module["_free"]=function(){return(_free=Module["_free"]=Module["asm"]["free"]).apply(null,arguments)};var _de265_get_version=Module["_de265_get_version"]=function(){return(_de265_get_version=Module["_de265_get_version"]=Module["asm"]["de265_get_version"]).apply(null,arguments)};var _de265_get_version_number=Module["_de265_get_version_number"]=function(){return(_de265_get_version_number=Module["_de265_get_version_number"]=Module["asm"]["de265_get_version_number"]).apply(null,arguments)};var _de265_get_error_text=Module["_de265_get_error_text"]=function(){return(_de265_get_error_text=Module["_de265_get_error_text"]=Module["asm"]["de265_get_error_text"]).apply(null,arguments)};var _de265_isOK=Module["_de265_isOK"]=function(){return(_de265_isOK=Module["_de265_isOK"]=Module["asm"]["de265_isOK"]).apply(null,arguments)};var _de265_new_decoder=Module["_de265_new_decoder"]=function(){return(_de265_new_decoder=Module["_de265_new_decoder"]=Module["asm"]["de265_new_decoder"]).apply(null,arguments)};var _de265_free_decoder=Module["_de265_free_decoder"]=function(){return(_de265_free_decoder=Module["_de265_free_decoder"]=Module["asm"]["de265_free_decoder"]).apply(null,arguments)};var _de265_push_data=Module["_de265_push_data"]=function(){return(_de265_push_data=Module["_de265_push_data"]=Module["asm"]["de265_push_data"]).apply(null,arguments)};var _de265_flush_data=Module["_de265_flush_data"]=function(){return(_de265_flush_data=Module["_de265_flush_data"]=Module["asm"]["de265_flush_data"]).apply(null,arguments)};var _de265_decode=Module["_de265_decode"]=function(){return(_de265_decode=Module["_de265_decode"]=Module["asm"]["de265_decode"]).apply(null,arguments)};var _de265_push_NAL=Module["_de265_push_NAL"]=function(){return(_de265_push_NAL=Module["_de265_push_NAL"]=Module["asm"]["de265_push_NAL"]).apply(null,arguments)};var _de265_push_end_of_NAL=Module["_de265_push_end_of_NAL"]=function(){return(_de265_push_end_of_NAL=Module["_de265_push_end_of_NAL"]=Module["asm"]["de265_push_end_of_NAL"]).apply(null,arguments)};var _de265_push_end_of_frame=Module["_de265_push_end_of_frame"]=function(){return(_de265_push_end_of_frame=Module["_de265_push_end_of_frame"]=Module["asm"]["de265_push_end_of_frame"]).apply(null,arguments)};var _de265_reset=Module["_de265_reset"]=function(){return(_de265_reset=Module["_de265_reset"]=Module["asm"]["de265_reset"]).apply(null,arguments)};var _de265_get_next_picture=Module["_de265_get_next_picture"]=function(){return(_de265_get_next_picture=Module["_de265_get_next_picture"]=Module["asm"]["de265_get_next_picture"]).apply(null,arguments)};var _de265_peek_next_picture=Module["_de265_peek_next_picture"]=function(){return(_de265_peek_next_picture=Module["_de265_peek_next_picture"]=Module["asm"]["de265_peek_next_picture"]).apply(null,arguments)};var _de265_release_next_picture=Module["_de265_release_next_picture"]=function(){return(_de265_release_next_picture=Module["_de265_release_next_picture"]=Module["asm"]["de265_release_next_picture"]).apply(null,arguments)};var _de265_get_highest_TID=Module["_de265_get_highest_TID"]=function(){return(_de265_get_highest_TID=Module["_de265_get_highest_TID"]=Module["asm"]["de265_get_highest_TID"]).apply(null,arguments)};var _de265_get_current_TID=Module["_de265_get_current_TID"]=function(){return(_de265_get_current_TID=Module["_de265_get_current_TID"]=Module["asm"]["de265_get_current_TID"]).apply(null,arguments)};var _de265_set_limit_TID=Module["_de265_set_limit_TID"]=function(){return(_de265_set_limit_TID=Module["_de265_set_limit_TID"]=Module["asm"]["de265_set_limit_TID"]).apply(null,arguments)};var _de265_set_framerate_ratio=Module["_de265_set_framerate_ratio"]=function(){return(_de265_set_framerate_ratio=Module["_de265_set_framerate_ratio"]=Module["asm"]["de265_set_framerate_ratio"]).apply(null,arguments)};var _de265_change_framerate=Module["_de265_change_framerate"]=function(){return(_de265_change_framerate=Module["_de265_change_framerate"]=Module["asm"]["de265_change_framerate"]).apply(null,arguments)};var _de265_get_warning=Module["_de265_get_warning"]=function(){return(_de265_get_warning=Module["_de265_get_warning"]=Module["asm"]["de265_get_warning"]).apply(null,arguments)};var _de265_set_parameter_bool=Module["_de265_set_parameter_bool"]=function(){return(_de265_set_parameter_bool=Module["_de265_set_parameter_bool"]=Module["asm"]["de265_set_parameter_bool"]).apply(null,arguments)};var _de265_set_parameter_int=Module["_de265_set_parameter_int"]=function(){return(_de265_set_parameter_int=Module["_de265_set_parameter_int"]=Module["asm"]["de265_set_parameter_int"]).apply(null,arguments)};var _de265_get_parameter_bool=Module["_de265_get_parameter_bool"]=function(){return(_de265_get_parameter_bool=Module["_de265_get_parameter_bool"]=Module["asm"]["de265_get_parameter_bool"]).apply(null,arguments)};var _de265_get_number_of_input_bytes_pending=Module["_de265_get_number_of_input_bytes_pending"]=function(){return(_de265_get_number_of_input_bytes_pending=Module["_de265_get_number_of_input_bytes_pending"]=Module["asm"]["de265_get_number_of_input_bytes_pending"]).apply(null,arguments)};var _de265_get_number_of_NAL_units_pending=Module["_de265_get_number_of_NAL_units_pending"]=function(){return(_de265_get_number_of_NAL_units_pending=Module["_de265_get_number_of_NAL_units_pending"]=Module["asm"]["de265_get_number_of_NAL_units_pending"]).apply(null,arguments)};var _de265_get_image_width=Module["_de265_get_image_width"]=function(){return(_de265_get_image_width=Module["_de265_get_image_width"]=Module["asm"]["de265_get_image_width"]).apply(null,arguments)};var _de265_get_image_height=Module["_de265_get_image_height"]=function(){return(_de265_get_image_height=Module["_de265_get_image_height"]=Module["asm"]["de265_get_image_height"]).apply(null,arguments)};var _de265_get_bits_per_pixel=Module["_de265_get_bits_per_pixel"]=function(){return(_de265_get_bits_per_pixel=Module["_de265_get_bits_per_pixel"]=Module["asm"]["de265_get_bits_per_pixel"]).apply(null,arguments)};var _de265_get_chroma_format=Module["_de265_get_chroma_format"]=function(){return(_de265_get_chroma_format=Module["_de265_get_chroma_format"]=Module["asm"]["de265_get_chroma_format"]).apply(null,arguments)};var _de265_get_image_plane=Module["_de265_get_image_plane"]=function(){return(_de265_get_image_plane=Module["_de265_get_image_plane"]=Module["asm"]["de265_get_image_plane"]).apply(null,arguments)};var _de265_get_image_plane_user_data=Module["_de265_get_image_plane_user_data"]=function(){return(_de265_get_image_plane_user_data=Module["_de265_get_image_plane_user_data"]=Module["asm"]["de265_get_image_plane_user_data"]).apply(null,arguments)};var _de265_get_image_PTS=Module["_de265_get_image_PTS"]=function(){return(_de265_get_image_PTS=Module["_de265_get_image_PTS"]=Module["asm"]["de265_get_image_PTS"]).apply(null,arguments)};var _de265_get_image_user_data=Module["_de265_get_image_user_data"]=function(){return(_de265_get_image_user_data=Module["_de265_get_image_user_data"]=Module["asm"]["de265_get_image_user_data"]).apply(null,arguments)};var _de265_set_image_user_data=Module["_de265_set_image_user_data"]=function(){return(_de265_set_image_user_data=Module["_de265_set_image_user_data"]=Module["asm"]["de265_set_image_user_data"]).apply(null,arguments)};var _malloc=Module["_malloc"]=function(){return(_malloc=Module["_malloc"]=Module["asm"]["malloc"]).apply(null,arguments)};var _de265_set_verbosity=Module["_de265_set_verbosity"]=function(){return(_de265_set_verbosity=Module["_de265_set_verbosity"]=Module["asm"]["de265_set_verbosity"]).apply(null,arguments)};var ___errno_location=Module["___errno_location"]=function(){return(___errno_location=Module["___errno_location"]=Module["asm"]["__errno_location"]).apply(null,arguments)};var _emscripten_main_thread_process_queued_calls=Module["_emscripten_main_thread_process_queued_calls"]=function(){return(_emscripten_main_thread_process_queued_calls=Module["_emscripten_main_thread_process_queued_calls"]=Module["asm"]["emscripten_main_thread_process_queued_calls"]).apply(null,arguments)};var stackSave=Module["stackSave"]=function(){return(stackSave=Module["stackSave"]=Module["asm"]["stackSave"]).apply(null,arguments)};var stackRestore=Module["stackRestore"]=function(){return(stackRestore=Module["stackRestore"]=Module["asm"]["stackRestore"]).apply(null,arguments)};var stackAlloc=Module["stackAlloc"]=function(){return(stackAlloc=Module["stackAlloc"]=Module["asm"]["stackAlloc"]).apply(null,arguments)};var _setThrew=Module["_setThrew"]=function(){return(_setThrew=Module["_setThrew"]=Module["asm"]["setThrew"]).apply(null,arguments)};var dynCall_jiji=Module["dynCall_jiji"]=function(){return(dynCall_jiji=Module["dynCall_jiji"]=Module["asm"]["dynCall_jiji"]).apply(null,arguments)};var calledRun;function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}dependenciesFulfilled=function runCaller(){if(!calledRun)run();if(!calledRun)dependenciesFulfilled=runCaller};function run(args){args=args||arguments_;if(runDependencies>0){return}preRun();if(runDependencies>0){return}function doRun(){if(calledRun)return;calledRun=true;Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){Module["setStatus"]("")},1);doRun()},1)}else{doRun()}}Module["run"]=run;if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}noExitRuntime=true;run();delete this["Module"];var libde265={DE265_OK:0,DE265_ERROR_NO_SUCH_FILE:1,DE265_ERROR_EOF:3,DE265_ERROR_COEFFICIENT_OUT_OF_IMAGE_BOUNDS:4,DE265_ERROR_CHECKSUM_MISMATCH:5,DE265_ERROR_CTB_OUTSIDE_IMAGE_AREA:6,DE265_ERROR_OUT_OF_MEMORY:7,DE265_ERROR_CODED_PARAMETER_OUT_OF_RANGE:8,DE265_ERROR_IMAGE_BUFFER_FULL:9,DE265_ERROR_CANNOT_START_THREADPOOL:10,DE265_ERROR_LIBRARY_INITIALIZATION_FAILED:11,DE265_ERROR_LIBRARY_NOT_INITIALIZED:12,DE265_ERROR_WAITING_FOR_INPUT_DATA:13,DE265_ERROR_CANNOT_PROCESS_SEI:14,DE265_ERROR_PARAMETER_PARSING:15,DE265_ERROR_NO_INITIAL_SLICE_HEADER:16,DE265_ERROR_PREMATURE_END_OF_SLICE:17,DE265_ERROR_UNSPECIFIED_DECODING_ERROR:18,DE265_ERROR_MAX_THREAD_CONTEXTS_EXCEEDED:500,DE265_ERROR_MAX_NUMBER_OF_SLICES_EXCEEDED:501,DE265_ERROR_NOT_IMPLEMENTED_YET:502,DE265_WARNING_NO_WPP_CANNOT_USE_MULTITHREADING:1e3,DE265_WARNING_WARNING_BUFFER_FULL:1001,DE265_WARNING_PREMATURE_END_OF_SLICE_SEGMENT:1002,DE265_WARNING_INCORRECT_ENTRY_POINT_OFFSET:1003,DE265_WARNING_CTB_OUTSIDE_IMAGE_AREA:1004,DE265_WARNING_SPS_HEADER_INVALID:1005,DE265_WARNING_PPS_HEADER_INVALID:1006,DE265_WARNING_SLICEHEADER_INVALID:1007,DE265_WARNING_INCORRECT_MOTION_VECTOR_SCALING:1008,DE265_WARNING_NONEXISTING_PPS_REFERENCED:1009,DE265_WARNING_NONEXISTING_SPS_REFERENCED:1010,DE265_WARNING_BOTH_PREDFLAGS_ZERO:1011,DE265_WARNING_NONEXISTING_REFERENCE_PICTURE_ACCESSED:1012,DE265_WARNING_NUMMVP_NOT_EQUAL_TO_NUMMVQ:1013,DE265_WARNING_NUMBER_OF_SHORT_TERM_REF_PIC_SETS_OUT_OF_RANGE:1014,DE265_WARNING_SHORT_TERM_REF_PIC_SET_OUT_OF_RANGE:1015,DE265_WARNING_FAULTY_REFERENCE_PICTURE_LIST:1016,DE265_WARNING_EOSS_BIT_NOT_SET:1017,DE265_WARNING_MAX_NUM_REF_PICS_EXCEEDED:1018,DE265_WARNING_INVALID_CHROMA_FORMAT:1019,DE265_WARNING_SLICE_SEGMENT_ADDRESS_INVALID:1020,DE265_WARNING_DEPENDENT_SLICE_WITH_ADDRESS_ZERO:1021,DE265_WARNING_NUMBER_OF_THREADS_LIMITED_TO_MAXIMUM:1022,DE265_NON_EXISTING_LT_REFERENCE_CANDIDATE_IN_SLICE_HEADER:1023,DE265_WARNING_CANNOT_APPLY_SAO_OUT_OF_MEMORY:1024,DE265_WARNING_SPS_MISSING_CANNOT_DECODE_SEI:1025,DE265_WARNING_COLLOCATED_MOTION_VECTOR_OUTSIDE_IMAGE_AREA:1026,de265_get_version:cwrap("de265_get_version","string"),de265_get_version_number:cwrap("de265_get_version_number","number"),de265_get_error_text:cwrap("de265_get_error_text","string",["number"]),de265_isOK:cwrap("de265_isOK","number",["number"]),de265_set_verbosity:cwrap("de265_set_verbosity","number",["number"]),de265_chroma_mono:0,de265_chroma_420:1,de265_chroma_422:2,de265_chroma_444:3,de265_get_image_width:cwrap("de265_get_image_width","number",["number","number"]),de265_get_image_height:cwrap("de265_get_image_height","number",["number","number"]),de265_get_chroma_format:cwrap("de265_get_chroma_format","number",["number"]),de265_get_bits_per_pixel:cwrap("de265_get_bits_per_pixel","number",["number","number"]),de265_get_image_plane:cwrap("de265_get_image_plane","number",["number","number","number"]),de265_get_image_plane_user_data:cwrap("de265_get_image_plane_user_data","number",["number","number"]),de265_get_image_PTS:cwrap("de265_get_image_PTS","number",["number"]),de265_get_image_user_data:cwrap("de265_get_image_user_data","number",["number"]),de265_set_image_user_data:cwrap("de265_set_image_user_data","number",["number","number"]),de265_new_decoder:cwrap("de265_new_decoder","number"),de265_free_decoder:cwrap("de265_free_decoder","number",["number"]),de265_push_data:cwrap("de265_push_data","number",["number","array","number","number","number"]),de265_push_end_of_NAL:cwrap("de265_push_end_of_NAL","number",["number"]),de265_push_end_of_frame:cwrap("de265_push_end_of_frame","number",["number"]),de265_push_NAL:cwrap("de265_push_NAL","number",["number","array","number","number","number"]),de265_flush_data:cwrap("de265_flush_data","number",["number"]),de265_get_number_of_input_bytes_pending:cwrap("de265_get_number_of_input_bytes_pending","number",["number"]),de265_get_number_of_NAL_units_pending:cwrap("de265_get_number_of_NAL_units_pending","number",["number"]),de265_decode:cwrap("de265_decode","number",["number","number"]),de265_reset:cwrap("de265_reset","number",["number"]),de265_peek_next_picture:cwrap("de265_peek_next_picture","number",["number"]),de265_get_next_picture:cwrap("de265_get_next_picture","number",["number"]),de265_release_next_picture:cwrap("de265_release_next_picture","number",["number"]),de265_get_warning:cwrap("de265_get_warning","number",["number"]),de265_get_highest_TID:cwrap("de265_get_highest_TID","number",["number"]),de265_get_current_TID:cwrap("de265_get_current_TID","number",["number"]),de265_set_limit_TID:cwrap("de265_set_limit_TID","number",["number","number"]),de265_set_framerate_ratio:cwrap("de265_set_framerate_ratio","number",["number","number"]),de265_change_framerate:cwrap("de265_change_framerate","number",["number","number"]),DE265_DECODER_PARAM_BOOL_SEI_CHECK_HASH:0,DE265_DECODER_PARAM_DUMP_SPS_HEADERS:1,DE265_DECODER_PARAM_DUMP_VPS_HEADERS:2,DE265_DECODER_PARAM_DUMP_PPS_HEADERS:3,DE265_DECODER_PARAM_DUMP_SLICE_HEADERS:4,DE265_DECODER_PARAM_ACCELERATION_CODE:5,DE265_DECODER_PARAM_SUPPRESS_FAULTY_PICTURES:6,DE265_DECODER_PARAM_DISABLE_DEBLOCKING:7,DE265_DECODER_PARAM_DISABLE_SAO:8,de265_acceleration_SCALAR:0,de265_acceleration_MMX:10,de265_acceleration_SSE:20,de265_acceleration_SSE2:30,de265_acceleration_SSE4:40,de265_acceleration_AVX:50,de265_acceleration_AVX2:60,de265_acceleration_ARM:70,de265_acceleration_NEON:80,de265_acceleration_AUTO:1e4,de265_set_parameter_bool:cwrap("de265_set_parameter_bool","number",["number","number","number"]),de265_set_parameter_int:cwrap("de265_set_parameter_int","number",["number","number","number"]),de265_get_parameter_bool:cwrap("de265_get_parameter_bool","number",["number","number"])};var Image=function(decoder,img){this.decoder=decoder;this.img=img;this.width=null;this.height=null};Image.prototype.free=function(){};Image.prototype.get_width=function(){if(this.width===null){this.width=libde265.de265_get_image_width(this.img,0)}return this.width};Image.prototype.get_height=function(){if(this.height===null){this.height=libde265.de265_get_image_height(this.img,0)}return this.height};Image.prototype.display=function(imageData,callback){var w=this.get_width();var h=this.get_height();var chroma=libde265.de265_get_chroma_format(this.img);var stride=_malloc(4);var y=libde265.de265_get_image_plane(this.img,0,stride);var stridey=getValue(stride,"i32");var bppy=libde265.de265_get_bits_per_pixel(this.img,0);var u=libde265.de265_get_image_plane(this.img,1,stride);var strideu=getValue(stride,"i32");var bppu=libde265.de265_get_bits_per_pixel(this.img,1);var v=libde265.de265_get_image_plane(this.img,2,stride);var stridev=getValue(stride,"i32");var bppv=libde265.de265_get_bits_per_pixel(this.img,2);_free(stride);this.decoder.convert_yuv2rgb(chroma,y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,imageData,callback)};function worker_func(){self.addEventListener("message",function(e){var data=e.data;switch(data["cmd"]){case"start":break;case"stop":this.postMessage({"cmd":"stopped"});self.close();break;case"convert":var img=_do_convert_yuv2rgb(data["data"]["chroma"],data["data"]["y"],data["data"]["u"],data["data"]["v"],data["data"]["w"],data["data"]["h"],data["data"]["stridey"],data["data"]["strideu"],data["data"]["stridev"],data["data"]["bppy"],data["data"]["bppu"],data["data"]["bppv"]);this.postMessage({"cmd":"converted","data":{"image":img}});break;default:break}},0)}var worker_blob_url=null;var WorkerConverter=function(){this.callbacks=[];if(worker_blob_url===null){var worker_func_data=worker_func.toString();var worker_func_name=worker_func.name;if(!worker_func_name){worker_func_name=/^function\s+([\w\$]+)\s*\(/.exec(worker_func_data)[1]}var blob=new Blob(["(function() {\n",_do_convert_yuv420.toString()+";\n",_do_convert_yuv2rgb.toString()+";\n",worker_func_data+";\n",worker_func_name+"();\n","}).call(this);"],{"type":"text/javascript"});worker_blob_url=window.URL.createObjectURL(blob)}var that=this;this.worker=new Worker(worker_blob_url);this.worker.addEventListener("message",function(e){switch(e.data["cmd"]){case"converted":var cb=that.callbacks[0];that.callbacks=that.callbacks.splice(1);cb(e.data["data"]["image"]);break;case"stopped":that.callbacks=null;that=null;break;default:break}},false);this.worker.postMessage({"cmd":"start"})};WorkerConverter.prototype.destroy=function(){if(this.worker){this.worker.postMessage({"cmd":"stop"});this.worker=null}};WorkerConverter.prototype.convert=function(chroma,y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,imageData,callback){var msg={"cmd":"convert","data":{"chroma":chroma,"y":new Uint8Array(y),"u":new Uint8Array(u),"v":new Uint8Array(v),"w":w,"h":h,"stridey":stridey,"strideu":strideu,"stridev":stridev,"bppy":bppy,"bppu":bppu,"bppv":bppv}};this.callbacks.push(function(data){if(imageData.data.set){imageData.data.set(data)}else{var dest=imageData.data;var cnt=dest.length;for(var i=0;i<cnt;i++){dest[i]=data[i]}}callback(imageData)});this.worker.postMessage(msg)};var LocalConverter=function(){};LocalConverter.prototype.destroy=function(){};LocalConverter.prototype.convert=function(chroma,y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,imageData,callback){_do_convert_yuv2rgb(chroma,y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,imageData.data);callback(imageData)};var Decoder=function(){this.image_callback=null;this.more=_malloc(2);this.stop=false;this.ctx=libde265.de265_new_decoder();if(typeof Worker!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Blob!=="undefined"){this.converter=new WorkerConverter}else{this.converter=new LocalConverter}};Decoder.prototype.free=function(){if(this.converter){this.converter.destroy();this.converter=null}libde265.de265_free_decoder(this.ctx);this.ctx=null;_free(this.more);this.more=null};Decoder.prototype.set_image_callback=function(callback){this.image_callback=callback};Decoder.prototype.reset=function(){libde265.de265_reset(this.ctx)};Decoder.prototype.push_data=function(data,pts){pts=pts||0;return libde265.de265_push_data(this.ctx,data,data.length,pts,0)};Decoder.prototype.flush=function(){this.stop=true;return libde265.de265_flush_data(this.ctx)};Decoder.prototype.has_more=function(){return!this.stop||getValue(this.more,"i16")!==0};Decoder.prototype.set_framerate_ratio=function(ratio){libde265.de265_set_framerate_ratio(this.ctx,ratio)};Decoder.prototype.disable_filters=function(disable){libde265.de265_set_parameter_bool(this.ctx,libde265.DE265_DECODER_PARAM_DISABLE_DEBLOCKING,!!disable);libde265.de265_set_parameter_bool(this.ctx,libde265.DE265_DECODER_PARAM_DISABLE_SAO,!!disable)};Decoder.prototype.decode=function(callback){var err;setValue(this.more,1,"i16");while(getValue(this.more,"i16")!==0){err=libde265.de265_decode(this.ctx,this.more);if(!libde265.de265_isOK(err)){setValue(this.more,0,"i16");break}var img=libde265.de265_get_next_picture(this.ctx);if(img){if(this.image_callback){this.image_callback(new Image(this,img))}break}}callback(err);return};function _do_convert_yuv420(y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,dest){var yval;var uval;var vval;var xpos=0;var ypos=0;var w2=w>>1;var maxi=w2*h;var yoffset=0;var uoffset=0;var voffset=0;var x2;var i2;for(var i=0;i<maxi;i++){i2=i<<1;x2=xpos<<1;yval=1.164*(y[yoffset+x2]-16);uval=u[uoffset+xpos]-128;vval=v[voffset+xpos]-128;dest[(i2<<2)+0]=yval+1.596*vval;dest[(i2<<2)+1]=yval-.813*vval-.391*uval;dest[(i2<<2)+2]=yval+2.018*uval;dest[(i2<<2)+3]=255;yval=1.164*(y[yoffset+x2+1]-16);dest[(i2+1<<2)+0]=yval+1.596*vval;dest[(i2+1<<2)+1]=yval-.813*vval-.391*uval;dest[(i2+1<<2)+2]=yval+2.018*uval;dest[(i2+1<<2)+3]=255;xpos++;if(xpos===w2){xpos=0;ypos++;yoffset+=stridey;uoffset=(ypos>>1)*strideu;voffset=(ypos>>1)*stridev}}}function _do_convert_yuv2rgb(chroma,y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,dest){if(!dest){dest=new Uint8ClampedArray(w*h*4)}switch(chroma){case 0:console.log("Chroma format not implemented yet",chroma,bppy,bppu,bppv);break;case 1:if(bppy!==8||bppu!==8||bppv!==8){console.log("Chroma format not implemented yet",chroma,bppy,bppu,bppv)}else{_do_convert_yuv420(y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,dest)}break;case 2:console.log("Chroma format not implemented yet",chroma,bppy,bppu,bppv);break;case 3:console.log("Chroma format not implemented yet",chroma,bppy,bppu,bppv);break;default:console.log("Unsupported chroma format",chroma,bppy,bppu,bppv);break}return dest}Decoder.prototype.convert_yuv2rgb=function(chroma,y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,imageData,callback){y=HEAPU8.subarray(y,y+h*stridey);u=HEAPU8.subarray(u,u+h*strideu);v=HEAPU8.subarray(v,v+h*stridev);this.converter.convert(chroma,y,u,v,w,h,stridey,strideu,stridev,bppy,bppu,bppv,imageData,callback)};libde265.Decoder=Decoder;var RawPlayer=function(canvas){this.canvas=canvas;this.ctx=canvas.getContext("2d");this.status_cb=null;this.error_cb=null;this.ratio=null;this.filters=false;this._reset()};RawPlayer.prototype._reset=function(){this.start=null;this.frames=0;this.image_data=null;this.running=false;this.pending_image_data=null};RawPlayer.prototype.set_status_callback=function(callback){this.status_cb=callback};RawPlayer.prototype._set_status=function(){if(this.status_cb){this.status_cb.apply(this.status_cb,arguments)}};RawPlayer.prototype.set_error_callback=function(callback){this.error_cb=callback};RawPlayer.prototype._set_error=function(error,message){if(this.error_cb){this.error_cb(error,message)}};RawPlayer.prototype._display_image=function(image){if(!this.start){this.start=new Date;this._set_status("playing")}else{this.frames+=1;var duration=new Date-this.start;if(duration>1e3){this._set_status("fps",this.frames/(duration*.001))}}var w=image.get_width();var h=image.get_height();if(w!=this.canvas.width||h!=this.canvas.height||!this.image_data){this.canvas.width=w;this.canvas.height=h;this.image_data=this.ctx.createImageData(w,h);var image_data=this.image_data.data;for(var i=0;i<w*h;i++){image_data[i*4+3]=255}}var that=this;image.display(this.image_data,function(display_image_data){if(window.requestAnimationFrame){that.pending_image_data=display_image_data;window.requestAnimationFrame(function(){if(that.pending_image_data){that.ctx.putImageData(that.pending_image_data,0,0);that.pending_image_data=null}})}else{that.ctx.putImageData(display_image_data,0,0)}})};RawPlayer.prototype._handle_onload=function(request,event){var that=this;this._set_status("initializing");var decoder=new Decoder;decoder.set_image_callback(function(image){that._display_image(image);image.free()});var data=request.response;var pos=0;var remaining=data.byteLength;var ratio=null;var filters=false;var decode=function(){if(!that.running){return}var err;if(remaining===0){err=decoder.flush()}else{var l=4096;if(l>remaining){l=remaining}var tmp=new Uint8Array(data,pos,l);err=decoder.push_data(tmp);pos+=l;remaining-=l}if(!libde265.de265_isOK(err)){that._set_error(err,libde265.de265_get_error_text(err));return}if(that.ratio!==ratio){decoder.set_framerate_ratio(that.ratio);ratio=that.ratio}if(that.filters!==filters){decoder.disable_filters(that.filters);filters=that.filters}decoder.decode(function(err){switch(err){case libde265.DE265_ERROR_WAITING_FOR_INPUT_DATA:setTimeout(decode,0);return;default:if(!libde265.de265_isOK(err)){that._set_error(err,libde265.de265_get_error_text(err));return}}if(remaining>0||decoder.has_more()){setTimeout(decode,0);return}decoder.free();that.stop()})};setTimeout(decode,0)};RawPlayer.prototype.playback=function(url){this._reset();var request=new XMLHttpRequest;request.open("get",url,true);request.responseType="arraybuffer";var that=this;request.onload=function(event){that._handle_onload(request,event)};this._set_status("loading");this.running=true;request.send()};RawPlayer.prototype.stop=function(){this._set_status("stopped");this._reset()};RawPlayer.prototype.set_framerate_ratio=function(ratio){this.ratio=ratio};RawPlayer.prototype.disable_filters=function(disable){this.filters=disable};libde265.RawPlayer=RawPlayer;var root=this;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=libde265}exports.libde265=libde265}else{root.libde265=libde265}if(typeof define==="function"&&define.amd){define([],function(){return libde265})}}).call(this);
